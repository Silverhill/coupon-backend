{"version":3,"sources":["../../../server/strategies/facebook/passport.js"],"names":["setup","User","config","use","clientID","facebook","appId","clientSecret","secret","callbackURL","profileFields","accessToken","refreshToken","profile","done","findOne","id","exec","then","user","name","displayName","email","emails","value","role","provider","_json","save","savedUser","catch","err"],"mappings":"AAAA;;;;;QAKgBA,K,GAAAA,K;;AAHhB;;;;AACA;;;;AAEO,SAASA,KAAT,CAAeC,IAAf,EAAqBC,MAArB,EAA6B;AAClC,qBAASC,GAAT,CAAa,+BAAqB;AAChCC,cAAUF,OAAOG,QAAP,CAAgBC,KADM;AAEhCC,kBAAcL,OAAOG,QAAP,CAAgBG,MAFE;AAGhCC,iBAAaP,OAAOG,QAAP,CAAgBI,WAHG;AAIhCC,mBAAe,CACb,aADa,EAEb,QAFa,EAGb,MAHa,EAIb,QAJa,EAKb,eALa,EAMb,OANa;AAJiB,GAArB,EAab,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,OAApC,EAA6CC,IAA7C,EAAmD;AACjDb,SAAKc,OAAL,CAAa,EAAC,eAAeF,QAAQG,EAAxB,EAAb,EAA0CC,IAA1C,GACGC,IADH,CACQ,gBAAQ;AACZ,UAAGC,IAAH,EAAS;AACP,eAAOL,KAAK,IAAL,EAAWK,IAAX,CAAP;AACD;;AAEDA,aAAO,IAAIlB,IAAJ,CAAS;AACdmB,cAAMP,QAAQQ,WADA;AAEdC,eAAOT,QAAQU,MAAR,CAAe,CAAf,EAAkBC,KAFX;AAGdC,cAAM,QAHQ;AAIdC,kBAAU,UAJI;AAKdrB,kBAAUQ,QAAQc;AALJ,OAAT,CAAP;AAOAR,WAAKS,IAAL,GACGV,IADH,CACQ;AAAA,eAAaJ,KAAK,IAAL,EAAWe,SAAX,CAAb;AAAA,OADR,EAEGC,KAFH,CAES;AAAA,eAAOhB,KAAKiB,GAAL,CAAP;AAAA,OAFT;AAGD,KAhBH,EAiBGD,KAjBH,CAiBS;AAAA,aAAOhB,KAAKiB,GAAL,CAAP;AAAA,KAjBT;AAkBD,GAhCY,CAAb;AAiCD","file":"passport.js","sourcesContent":["'use strict';\n\nimport passport from 'passport';\nimport {Strategy as FacebookStrategy} from 'passport-facebook';\n\nexport function setup(User, config) {\n  passport.use(new FacebookStrategy({\n    clientID: config.facebook.appId,\n    clientSecret: config.facebook.secret,\n    callbackURL: config.facebook.callbackURL,\n    profileFields: [\n      'displayName',\n      'emails',\n      'name',\n      'gender',\n      'user_birthday',\n      'cover'\n    ]\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOne({'facebook.id': profile.id}).exec()\n      .then(user => {\n        if(user) {\n          return done(null, user);\n        }\n\n        user = new User({\n          name: profile.displayName,\n          email: profile.emails[0].value,\n          role: 'hunter',\n          provider: 'facebook',\n          facebook: profile._json\n        });\n        user.save()\n          .then(savedUser => done(null, savedUser))\n          .catch(err => done(err));\n      })\n      .catch(err => done(err));\n  }));\n}\n"]}