{"version":3,"sources":["../../../server/strategies/twitter/passport.js"],"names":["setup","User","config","use","consumerKey","twitter","appId","consumerSecret","secret","callbackURL","accessToken","refreshToken","profile","done","findOne","id","exec","then","user","name","displayName","username","role","provider","_json","save","savedUser","catch","err"],"mappings":"AAAA;;;;;QAKgBA,K,GAAAA,K;;AAHhB;;;;AACA;;;;AAEO,SAASA,KAAT,CAAeC,IAAf,EAAqBC,MAArB,EAA6B;AAClC,qBAASC,GAAT,CAAa,8BAAoB;AAC/BC,iBAAaF,OAAOG,OAAP,CAAeC,KADG;AAE/BC,oBAAgBL,OAAOG,OAAP,CAAeG,MAFA;AAG/BC,iBAAaP,OAAOG,OAAP,CAAeI;AAHG,GAApB,EAKb,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,OAApC,EAA6CC,IAA7C,EAAmD;AACjDZ,SAAKa,OAAL,CAAa,EAAE,cAAeF,QAAQG,EAAzB,EAAb,EAA4CC,IAA5C,GACGC,IADH,CACQ,gBAAQ;AACZ,UAAGC,IAAH,EAAS;AACP,eAAOL,KAAK,IAAL,EAAWK,IAAX,CAAP;AACD;;AAEDA,aAAO,IAAIjB,IAAJ,CAAS;AACdkB,cAAMP,QAAQQ,WADA;AAEdC,kBAAUT,QAAQS,QAFJ;AAGdC,cAAM,MAHQ;AAIdC,kBAAU,SAJI;AAKdlB,iBAASO,QAAQY;AALH,OAAT,CAAP;AAOAN,WAAKO,IAAL,GACGR,IADH,CACQ;AAAA,eAAaJ,KAAK,IAAL,EAAWa,SAAX,CAAb;AAAA,OADR,EAEGC,KAFH,CAES;AAAA,eAAOd,KAAKe,GAAL,CAAP;AAAA,OAFT;AAGD,KAhBH,EAiBGD,KAjBH,CAiBS;AAAA,aAAOd,KAAKe,GAAL,CAAP;AAAA,KAjBT;AAkBD,GAxBY,CAAb;AAyBD","file":"passport.js","sourcesContent":["'use strict';\n\nimport passport from 'passport';\nimport {Strategy as TwitterStrategy} from 'passport-twitter';\n\nexport function setup(User, config) {\n  passport.use(new TwitterStrategy({\n    consumerKey: config.twitter.appId,\n    consumerSecret: config.twitter.secret,\n    callbackURL: config.twitter.callbackURL\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOne({ 'twitter.id' : profile.id }).exec()\n      .then(user => {\n        if(user) {\n          return done(null, user);\n        }\n\n        user = new User({\n          name: profile.displayName,\n          username: profile.username,\n          role: 'user',\n          provider: 'twitter',\n          twitter: profile._json\n        });\n        user.save()\n          .then(savedUser => done(null, savedUser))\n          .catch(err => done(err));\n      })\n      .catch(err => done(err));\n  }));\n}\n"]}