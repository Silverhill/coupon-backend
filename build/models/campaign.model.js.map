{"version":3,"sources":["../../server/models/campaign.model.js"],"names":["Promise","require","CampaignSchema","startAt","type","Date","required","endAt","country","String","city","image","totalCoupons","Number","default","huntedCoupons","redeemedCoupons","initialAgeRange","finalAgeRange","title","description","customMessage","deleted","Boolean","createdAt","updatedAt","maker","ObjectId","ref","office","coupons","virtual","get","now","getTime","campaignStatus","UNAVAILABLE","AVAILABLE","SOLDOUT","EXPIRED","model"],"mappings":"AAAA;;;;;;AAGA;;;;AACA;;;;;;AAFA,mBAASA,OAAT,GAAmBC,QAAQ,UAAR,CAAnB;;;AAIA,IAAIC,iBAAiB,qBAAW;AAC9BC,WAAS;AACPC,UAAMC,IADC;AAEPC,cAAU;AAFH,GADqB;AAK9BC,SAAO;AACLH,UAAMC,IADD;AAELC,cAAU;AAFL,GALuB;AAS9BE,WAAS;AACPJ,UAAMK,MADC;AAEPH,cAAU;AAFH,GATqB;AAa9BI,QAAM;AACJN,UAAMK,MADF;AAEJH,cAAU;AAFN,GAbwB;AAiB9BK,SAAOF,MAjBuB;AAkB9BG,gBAAc;AACZR,UAAMS,MADM;AAEZC,aAAS;AAFG,GAlBgB;AAsB9BC,iBAAe;AACbX,UAAMS,MADO;AAEbC,aAAS;AAFI,GAtBe;AA0B9BE,mBAAiB;AACfZ,UAAMS,MADS;AAEfC,aAAS;AAFM,GA1Ba;AA8B9BG,mBAAiB;AACfb,UAAMS,MADS;AAEfC,aAAS;AAFM,GA9Ba;AAkC9BI,iBAAe;AACbd,UAAMS,MADO;AAEbC,aAAS;AAFI,GAlCe;AAsC9BK,SAAO;AACLf,UAAMK,MADD;AAELH,cAAU;AAFL,GAtCuB;AA0C9Bc,eAAaX,MA1CiB;AA2C9BY,iBAAeZ,MA3Ce;AA4C9Ba,WAAS;AACPlB,UAAMmB,OADC;AAEPT,aAAS;AAFF,GA5CqB;AAgD9BU,aAAW;AACTpB,UAAMC,IADG;AAETC,cAAU;AAFD,GAhDmB;AAoD9BmB,aAAW;AACTrB,UAAMC,IADG;AAETC,cAAU;AAFD,GApDmB;AAwD9BoB,SAAO;AACLtB,UAAM,iBAAOuB,QADR;AAELC,SAAK,OAFA;AAGLtB,cAAU;AAHL,GAxDuB;AA6D9BuB,UAAQ;AACNzB,UAAM,iBAAOuB,QADP;AAENC,SAAK;AAFC,GA7DsB;AAiE9BE,WAAS,CAAC;AACR1B,UAAM,iBAAOuB,QADL;AAERC,SAAK;AAFG,GAAD;AAjEqB,CAAX,CAArB;;AAwEA1B,eAAe6B,OAAf,CAAuB,QAAvB,EACGC,GADH,CACO,YAAY;AACf,MAAMC,MAAM5B,KAAK4B,GAAL,EAAZ;AACA,MAAIA,MAAM,KAAK9B,OAAL,CAAa+B,OAAb,EAAV,EAAkC;AAChC,WAAO,iBAAOC,cAAP,CAAsBC,WAA7B;AACD;AACD,MAAIH,OAAO,KAAK9B,OAAL,CAAa+B,OAAb,EAAP,IAAiCD,MAAM,KAAK1B,KAAL,CAAW2B,OAAX,EAA3C,EAAiE;AAC/D,QAAI,KAAKnB,aAAL,GAAqB,KAAKH,YAA9B,EAA4C;AAC1C,aAAO,iBAAOuB,cAAP,CAAsBE,SAA7B;AACD,KAFD,MAEO;AACL,aAAO,iBAAOF,cAAP,CAAsBG,OAA7B;AACD;AACF;AACD,MAAIL,OAAO,KAAK1B,KAAL,CAAW2B,OAAX,EAAX,EAAiC;AAC/B,WAAO,iBAAOC,cAAP,CAAsBI,OAA7B;AACD;AACF,CAhBH;;kBAkBe,mBAASC,KAAT,CAAe,UAAf,EAA2BtC,cAA3B,C","file":"campaign.model.js","sourcesContent":["'use strict';\n\nmongoose.Promise = require('bluebird');\nimport mongoose, {Schema} from 'mongoose';\nimport config from '../config';\n\nvar CampaignSchema = new Schema({\n  startAt: {\n    type: Date,\n    required: true\n  },\n  endAt: {\n    type: Date,\n    required: true\n  },\n  country: {\n    type: String,\n    required: true\n  },\n  city: {\n    type: String,\n    required: true\n  },\n  image: String,\n  totalCoupons: {\n    type: Number,\n    default: 0\n  },\n  huntedCoupons: {\n    type: Number,\n    default: 0\n  },\n  redeemedCoupons: {\n    type: Number,\n    default: 0\n  },\n  initialAgeRange: {\n    type: Number,\n    default: 18\n  },\n  finalAgeRange: {\n    type: Number,\n    default: 60\n  },\n  title: {\n    type: String,\n    required: true\n  },\n  description: String,\n  customMessage: String,\n  deleted: {\n    type: Boolean,\n    default: false\n  },\n  createdAt: {\n    type: Date,\n    required: true\n  },\n  updatedAt: {\n    type: Date,\n    required: true\n  },\n  maker: {\n    type: Schema.ObjectId,\n    ref: 'Maker',\n    required: true\n  },\n  office: {\n    type: Schema.ObjectId,\n    ref: 'Office'\n  },\n  coupons: [{\n    type: Schema.ObjectId,\n    ref: 'Coupon'\n  }]\n})\n\n\nCampaignSchema.virtual('status')\n  .get(function () {\n    const now = Date.now();\n    if (now < this.startAt.getTime()) {\n      return config.campaignStatus.UNAVAILABLE;\n    }\n    if (now >= this.startAt.getTime() && now < this.endAt.getTime()) {\n      if (this.huntedCoupons < this.totalCoupons) {\n        return config.campaignStatus.AVAILABLE;\n      } else {\n        return config.campaignStatus.SOLDOUT;\n      }\n    }\n    if (now >= this.endAt.getTime()) {\n      return config.campaignStatus.EXPIRED;\n    }\n  });\n\nexport default mongoose.model('Campaign', CampaignSchema);\n"]}